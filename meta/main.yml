---
dependencies:
  - role: meta/repository
    repository_key: '0xb9316a7bc7917b12'
    repository_url: 'deb http://ppa.launchpad.net/chris-lea/nginx-devel/ubuntu trusty main'

  - role: meta/monitor
    monitor_name: nginx
    monitor_pidfile: "{{ nginx_pidfile_path }}"

  - role: package/fluentd
    fluentd_sources:
      - path: "{{ nginx_access_log_path }}"
        format: '/^(?<time>[^ ]+ [^ ]+) \[(?<log_level>.*)\] (?<pid>\d*).(?<tid>[^:]*): (?<message>.*)$/'
        tag: nginx.access
      - path: "{{ nginx_error_log_path }}"
        format: '/^(?<time>[^ ]+ [^ ]+) \[(?<log_level>.*)\] (?<pid>\d*).(?<tid>[^:]*): (?<message>.*)$/'
        tag: nginx.error

  - role: package/logrotate
    logrotate_name: nginx
    logrotate_create_logs_with_owner: "{{ nginx_user }}"
